---
title: "シェルスクリプトマガジンにRust入門記事を寄稿しました"
date: 2020-01-25T09:22:34+08:00
draft: true
isCJKLanguage: true
categories:
- 執筆
tags:
- シェルスクリプトマガジン
- 入門者向け
---

[**シェルスクリプトマガジン Vol.64**][shellmag-vol-64] にRust入門記事を寄稿しました。
どんな内容か紹介します。

[shellmag-vol-64]: https://shell-mag.com/vol-64/

## 記事の概要

シェルスクリプトマガジンに寄稿した記事は２部構成になっています。
Part 1では、Rustの特徴、使いどころ、Rustのインストール方法、プログラミングのやり方などを、初心者にもわかりやすいように紹介しています。

Part 2ではCSV形式のデータを分析するという実用的なプログラムを扱っています。
chrono、clap、csv、serde_jsonなどの人気のクレートを用いることで、Rustにおけるプログラミングの雰囲気を感じてもらえるようにしました。

Part 2の終わりでは、読者の今後の学びのために、参考になりそうなオンラインドキュメントなどを紹介しています。

## Part 1について

**Part 1 Rustをはじめよう**（11ページ）

- **Rustとは**
    - Rustのプログラムコード
    - 生い立ちと開発体制
    - 増える大規模採用事例
- **Rustの特徴**
    - ハイパフォーマンス
    - さまざまな環境で実行できる
    - 安全性が保証される
    - 高い生産性
- **Rustの使いどころ**
    - コマンドラインツール
    - Webアプリケーション、ゲーム／チャットサーバー
    - 機械学習、科学技術計算
    - IoT、組み込みシステム
- **Rustのインストール**
    - リンカーのインストール
    - Rustツールチェーンのインストール
- **はじめてのRustプログラム**
    - パッケージの作成
    - プログラムのビルド
    - 関数定義の基本構文
    - 数値型について
    - 式と文
    - let文による変数の導入
    - if式による条件分岐
    - 繰り返し
    - 戻り値を返す
    - 変数のミュータビリティ（可変性）
    - main()関数の追加

今回寄稿したのは、この号の看板記事の一つ、特集1「はじめてのRust」でした。
特集1の全体（合計23ページ）を一人で書きました。

最初の数ページ、Rustの特徴くらいまでに読者に興味を持ってもらいたかったので、図表を使って誌面を賑やかにしています。
特に以下については、編集者さんからのリクエストもあり、図を多用して、なんとなくでも分かってもらうことを目標にしました。

- ハイパフォーマンスの項、「ゼロコスト抽象化」の例として、動的ディスパッチと静的ディスパッチを図解
- 安全性が保証されるの項、「所有権モデル」の例として、所有権のムーブと借用を図解

ページ数に限りがあるので大変でしたが、うまくまとめられたと思います。

「はじめてのRustプログラム」の節は入門記事としてよくある内容です。
ニュートン法を用いて平方根の近似値を求めるプログラムを題材にしています。

## Part 2について

**Part 2 コマンドラインプログラムを作ろう** （12ページ）

- CSVファイルのダウンロード
- パッケージ作成と使用クレートの指定
- clapクレートでコマンドライン引数を処理
    - 列挙型のOption型とResult型
    - match式による場合分け
- コマンドライン引数を必須にする
- トレイトについて
- CSVファイルを開きエラーを処理する
- CSVファイルのレコードを順に読み込む
    - リリースビルドで高速化する
- CSVのレコードを表す構造体を定義する
- CSVのレコードをデシリアライズする
- カウンタをまとめた構造体を定義する
- 日時を表す文字列をchronoで変換する
- 対象レコードを絞り込む
- 統計処理を行う
- 統計情報をJSON形式で出力する
- まとめ
    - Rustの参考資料

Part 2では実用的なプログラムを扱っています。
掲載誌がシェルスクリプトマガジンということで、コマンドラインプログラムを題材に選びました。
といっても`grep`のような汎用的なコマンドを作るわけではなくて、特定のCSVファイルのデータを集計して、結果をJSON形式で出力するという簡単なものです。
具体的には、ニューヨーク市のタクシー＆リムジン委員会が公開している乗車記録データを分析し、マンハッタン中心部からJFK国際空港までの所要時間を時間帯ごとに集計します。

ソースコードは [ここ] にあります。

この乗車データは1ヶ月分だけでも690万件ほどあるので、Rustの高速性を体験してもらうのにいいかなと考えました。
筆者の平凡なPC環境でも、1ファイルを10秒かからずに処理できます。
（シングルスレッドのプログラムです）

chrono、clap、csv、serde_jsonなどの人気のクレートを使用していますので、Rustで実際になにか作るときにもきっと役に立つと思います。

## 寄稿してみての感想など

実践Rust入門で書いた内容の焼き直しのようなものなので、簡単に書けるかと思いましたが、やっぱり大変でした。
Rustは言語の機能が多く、他の言語にない概念も多いので、Rustを知らない読者向けに書くのは本当に難しく感じます。
（しかも限られたスペースで）　

ページ数の都合から、所有権モデルについて詳しく説明することは早々にあきらめて、特徴のところでの図解にとどめました。
それでもエラー処理などコードを書くうえで説明が避けられない部分もあり、どうしてもページ数が膨らんでしまいます。

毎回、執筆が終わると、Rust入門記事は書くのが大変なのでもう書きたくないなー、と思ってしまいます。
でも、読者の方からの反応が嬉しくて、また書いてしまうかも。

お世辞が入っていると思いますが、編集の方からは、雑誌の新言語の特集でここまで分かりやすいものは、そうないように思えます、と言っていただけたので、ある程度のレベルのものは書けたと思います。

